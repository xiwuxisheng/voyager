---
bg: "guilin.jpeg"
layout: post
title:  "iOS10以上新机首次安装app，请求网络权限"
crawlertitle: "iOS10请求网络权限"
summary: "一入坑门深似海"
date:   2019-05-30 19:11:47 +0700
categories: posts
tags: network permission
author: 习武
---
##引言  
iOS10以上iphone在使用app时会出现请求网络权限的提示，这功能只满足下列条件时才会出现：  
1.国行版本的iPhone手机  
2.系统版本在iOS10及以上  
3.首次安装一个App时,App只要进行网络请求,就会触发  

##提示示意图  
![网络权限图](/assets/images/network/networkPermission.png)  
根据图中可以看出现有三个选项及含义分别是：  
1.无线局域网与蜂窝移动网络，含义是该app即允许WLAN(理解成WiFi就行了)也允许4G/3G/2G等蜂窝网络访问；  
2.仅限无线局域网，含义就是只能在WiFi环境下使用，用4G/3G等就会无网络；  
3.不允许，顾名思义，完全离线，没办法网络使用。  

##可能出现问题的场景  
1.新用户第一次打开app时已经开启了网络权限，但是仍然会出现*首页*空白无数据或者显示不正常的情况，原因是网络请求发生在允许网络权限之前，那时app仍然处于无网络权限状态，导致获取数据失败了。  
2.用户不是第一次打开情况下，这种情况下一般是不会再次弹出提示的，这时候就要小心了。  
> 第一次打开时用户直接关闭了，这种情况下app应用依然是没有网络权限的，但是也不会提示，当时无法访问数据，用户只会认为app应用**有bug**；  
> 第一次如果选择了“不允许”，基本上同上；  
> 第一次如果选择了“仅限无线局域网”，那基本上在WiFi情况下正常，但是如果当时用户用的是蜂窝网络，那么悲剧了，依然是**有bug**。  

##解决思路  
###第1中场景
办法很多，也是网上提到的最多的处理方式，大体上的解决方案有下面几种：  
> 在*首页*中加入空白按钮，这里用的比较多的是OC版[DZNEmptyDataSet](https://github.com/dzenbot/DZNEmptyDataSet)和swift版[EmptyDataSet-Swift](https://github.com/Xiaoye220/EmptyDataSet-Swift)，这样在无数据显示的时候出现一个空白按钮提示，引导用户重新去刷新网络数据。  
> 